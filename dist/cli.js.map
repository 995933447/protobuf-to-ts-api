{"version":3,"file":"cli.js","mappings":"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","sources":["webpack://pb-to-ts-api/webpack/bootstrap","webpack://pb-to-ts-api/webpack/runtime/compat get default export","webpack://pb-to-ts-api/webpack/runtime/define property getters","webpack://pb-to-ts-api/webpack/runtime/hasOwnProperty shorthand","webpack://pb-to-ts-api/external commonjs \"chalk\"","webpack://pb-to-ts-api/external commonjs \"glob\"","webpack://pb-to-ts-api/external commonjs \"minimist\"","webpack://pb-to-ts-api/external commonjs \"express\"","webpack://pb-to-ts-api/external node-commonjs \"fs\"","webpack://pb-to-ts-api/external node-commonjs \"path\"","webpack://pb-to-ts-api/external commonjs \"mkdirp\"","webpack://pb-to-ts-api/external commonjs \"protobufjs-cli/pbjs\"","webpack://pb-to-ts-api/external commonjs \"protobufjs-cli/pbts\"","webpack://pb-to-ts-api/external commonjs \"protobufjs\"","webpack://pb-to-ts-api/./src/interfaces/RequestMethods.ts","webpack://pb-to-ts-api/./src/utils/getProtoOption.ts","webpack://pb-to-ts-api/./src/modules/saveApiFile.ts","webpack://pb-to-ts-api/external commonjs \"typescript-json-schema\"","webpack://pb-to-ts-api/external commonjs \"json-schema-faker\"","webpack://pb-to-ts-api/./src/modules/transferTSFile.ts","webpack://pb-to-ts-api/./src/modules/getPbjsFile.ts","webpack://pb-to-ts-api/./src/modules/getPbtsFile.ts","webpack://pb-to-ts-api/./src/modules/saveJSONSchemaFile.ts","webpack://pb-to-ts-api/./src/modules/saveMockJSONFile.ts","webpack://pb-to-ts-api/./src/modules/mockServer.ts","webpack://pb-to-ts-api/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"chalk\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"glob\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"minimist\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"express\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"fs\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"path\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"mkdirp\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"protobufjs-cli/pbjs\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"protobufjs-cli/pbts\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"protobufjs\");","export enum RequestMethods {\n  post = 'post',\n  get = 'get',\n}\n","/**\n * 通用方法：从 protobufjs 描述对象中获取指定自定义 option\n * @param descriptor message/field/service/method descriptor\n * @param name option 名字（无需加括号，例如 \"api_obj\"）\n * @returns 任意类型的 option 值，若不存在则返回 undefined\n */\nexport function getProtoOption(descriptor: any, name: string) {\n  if (!descriptor || !descriptor.options) return undefined;\n  // protobufjs 规范：自定义 option 必须为 \"(name)\" 或 \"(name).tag\" 格式\n  const key = name.startsWith(\"(\") ? name : `(${name})`;\n  return descriptor.options[key];\n}\n","import fs from \"fs\";\nimport path from \"path\";\n\nimport protobuf from \"protobufjs\";\n\nimport { IOptions } from \"../interfaces/IOptions\";\nimport { RequestMethods } from \"../interfaces/RequestMethods\";\nimport { getProtoOption } from \"../utils/getProtoOption\";\n\nconst getLinePerfix = (requestModule: string, tsDefineFilename: string) =>\n  `/* eslint-disable */\nimport request from \"${requestModule}\";\nimport api from './${tsDefineFilename.replace(\".ts\", \"\")}';\n`;\n\nconst getLine = (serviceName: string, apiMethods: ApiMethod[]) => {\n  let content = `\nexport class ${serviceName}Service {`;\n\n  for (const apiMethod of apiMethods) {\n    let requestType = `I${apiMethod.requestType}`;\n    let responseType = `I${apiMethod.responseType}`;\n    if (apiMethod.namespace) {\n      requestType = `${apiMethod.namespace}.${requestType}`;\n      responseType = `${apiMethod.namespace}.${responseType}`;\n    }\n    content += `\n\n  ${apiMethod.comment ? `/** ${apiMethod.comment} */` : \"/** no comment **/\"}\n  static async ${\n    apiMethod.methodName\n  }(req: api.${requestType}): Promise<api.${responseType}> {\n    return await request.${apiMethod.httpMethod}('${apiMethod.urlPath}', ${\n      apiMethod.httpMethod === \"get\" ? \"{ params: req }\" : \"req\"\n    })\n  };`;\n  }\n\n  content += `\n\n};\n`;\n  return content;\n};\n/**\n * 生成前端api请求文件\n * @param {String} pbtsFilePath 生成的d.ts定义文件的路径\n * @param {Object} options 用户传入的自定义配置选项\n */\nexport async function saveApiFile(\n  protoFilePath: string,\n  pbtsFilePath: string,\n  options: IOptions\n): Promise<ApiMethod[]> {\n  const { requestModule, baseUrl } = options;\n  // 获取当前d.ts文件的目录名称和文件名称\n  const tsDefineDirname = path.dirname(pbtsFilePath);\n  const tsDefineFilename = path.basename(pbtsFilePath);\n  let apiline = \"\";\n  apiline += getLinePerfix(requestModule, tsDefineFilename);\n\n  const apiMethods = await parseProtoApiMethods(protoFilePath, options);\n\n  const mapServiceToMethods = new Map<string, ApiMethod[]>();\n  for (const apiMethod of apiMethods) {\n    let serviceName = apiMethod.serviceName || \"\";\n    if (apiMethod.namespace) {\n      if (apiMethod.namespace.toLowerCase() != serviceName.toLowerCase()) {\n        serviceName =\n          apiMethod.namespace +\n          serviceName.slice(0, 1).toUpperCase() +\n          serviceName.slice(1);\n      }\n      mapServiceToMethods.get(serviceName) ||\n        mapServiceToMethods.set(serviceName, []);\n      mapServiceToMethods.get(serviceName)?.push(apiMethod);\n    }\n  }\n\n  for (const [serviceName, apiMethods] of mapServiceToMethods) {\n    apiline += getLine(serviceName, apiMethods);\n  }\n\n  await fs.promises.writeFile(\n    path.resolve(tsDefineDirname, tsDefineFilename.replace(\".d.ts\", \".ts\")),\n    apiline\n  );\n  return apiMethods;\n}\n\nexport class ApiMethod {\n  serviceName: string | undefined;\n  methodName: string | undefined;\n  requestType: string | undefined;\n  responseType: string | undefined;\n  httpMethod: string | undefined;\n  urlPath: string | undefined;\n  noAuth: boolean | undefined;\n  namespace: string | undefined;\n  comment: string | undefined;\n}\n\n/**\n * 解析api方法列表\n * @param {String} pbtsFilePath 生成的d.ts定义文件的路径\n * @param {Object} options 用户传入的自定义配置选项\n */\nasync function parseProtoApiMethods(\n  protoFilePath: string,\n  options: IOptions\n): Promise<ApiMethod[]> { \n  // 直接读取文件内容（必须手动读）\n  const protoSource = fs.readFileSync(protoFilePath, \"utf8\");\n\n  // 解析proto内容,读取注释和自定义option\n  const parsed = protobuf.parse(protoSource, {\n    keepCase: true,\n    preferTrailingComment: true,\n    alternateCommentMode: true,\n  });\n\n  const root = parsed.root;\n  root.resolveAll();\n\n  const apiMethods: ApiMethod[] = [];\n  const traverse = function (\n    nested: protobuf.NamespaceBase,\n    namespacePath: string\n  ) {\n    for (const nestedObj of Object.values(nested.nested || {})) {\n      if (nestedObj instanceof protobuf.Service) {\n        console.log(`Service: ${nestedObj.name}`);\n\n        for (const [methodName, method] of Object.entries(nestedObj.methods)) {\n          console.log(`  Method: ${methodName}`);\n          console.log(`  Method comment: ${method.comment || \"\"}`);\n\n          if (\n            options.protoOptionTagHttpMethod ||\n            options.protoOptionTagHttpPath\n          ) {\n            if (method.options) {\n              for (const [key, value] of Object.entries(method.options)) {\n                console.log(`    Option: ${key} = ${JSON.stringify(value)}`);\n              }\n\n              let protoOptionMethod = getProtoOption(\n                method,\n                options.protoOptionTagHttpMethod\n              );\n              let protoOptionPath = getProtoOption(\n                method,\n                options.protoOptionTagHttpPath\n              );\n              if (protoOptionMethod || protoOptionPath) {\n                if (!protoOptionMethod) {\n                  protoOptionMethod = RequestMethods.post;\n                }\n                if (!protoOptionPath) {\n                  protoOptionPath = `/${methodName}`;\n                }\n                const apiMethod = new ApiMethod();\n                apiMethods.push(apiMethod);\n                apiMethod.serviceName = nestedObj.name;\n                apiMethod.methodName = methodName;\n                apiMethod.requestType = method.requestType;\n                apiMethod.responseType = method.responseType;\n                apiMethod.namespace = namespacePath || undefined;\n                apiMethod.httpMethod = protoOptionMethod.toLowerCase();\n                apiMethod.urlPath = options.baseUrl + protoOptionPath;\n                apiMethod.comment = method.comment || \"\";\n              }\n            }\n          } else {\n            const apiMethod = new ApiMethod();\n            apiMethods.push(apiMethod);\n            apiMethod.serviceName = nestedObj.name;\n            apiMethod.methodName = methodName;\n            apiMethod.requestType = method.requestType;\n            apiMethod.responseType = method.responseType;\n            apiMethod.namespace = namespacePath || undefined;\n            apiMethod.httpMethod = RequestMethods.post;\n            apiMethod.urlPath = options.baseUrl + `/${methodName}`;\n            apiMethod.comment = method.comment || \"\";\n          }\n        }\n      }\n\n      if (nestedObj instanceof protobuf.Namespace) {\n        const childNamespace = namespacePath\n          ? `${namespacePath}.${nestedObj.name}`\n          : nestedObj.name;\n        traverse(nestedObj, childNamespace);\n      }\n    }\n  };\n\n  traverse(root, \"\");\n  return apiMethods;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"typescript-json-schema\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"json-schema-faker\");","import { Express } from 'express';\nimport fs from 'fs';\nimport path from 'path';\n\nimport { IOptions } from '../interfaces/IOptions';\nimport { getPbjsFile } from './getPbjsFile';\nimport { getPbtsFile } from './getPbtsFile';\nimport { generateMockRoute } from './mockServer';\nimport { saveApiFile } from './saveApiFile';\nimport { saveJSONSchemaFile } from './saveJSONSchemaFile';\nimport { saveMockJSONFile } from './saveMockJSONFile';\nimport { saveTypeScriptDefineFile } from './saveTypeScriptDefineFile';\n\n/**\n * 转换protobuf定义文件为ts定义文件和api请求文件\n * @param {String} filePath protobuf定义文件的路径\n * @param {Express} mockServer mockServer对象，是一个express实例化的对象\n * @param {Object} options 用户自定义配置\n */\nexport async function transferTSFile(filePath: string, mockServer: Express, options: IOptions) {\n  const pbjsFilePath = await getPbjsFile(filePath, options);\n  const pbtsFilePath = await getPbtsFile(pbjsFilePath, options);\n  await fs.promises.unlink(pbjsFilePath);\n  const apiMethods = await saveApiFile(filePath, pbtsFilePath, options);\n  const jsonSchemaFilePath = await saveJSONSchemaFile(pbtsFilePath);\n  const mockFilePath = await saveMockJSONFile(jsonSchemaFilePath);\n  console.log(`success generate ${filePath} to ${path.resolve(options.folder, filePath)}.d.ts and ${path.resolve(options.folder, filePath)}.ts`);\n  if (options.mock && mockServer) {\n    console.log('begin open mock server');\n    await generateMockRoute(apiMethods, mockFilePath, mockServer, options);\n  }\n}\n","import mkdirp from 'mkdirp';\nimport path from 'path';\nimport pbjs from 'protobufjs-cli/pbjs';\n\nimport { IOptions } from '../interfaces/IOptions';\n\n/**\n * 通过protobuf-cli生成临时的js文件，用于再生成ts文件，生成ts文件后，删掉临时的js文件\n * @param {String} filePath proto文件的路径\n * @returns {Promise<string>} 生成临时的js文件的路径\n */\nexport async function getPbjsFile(filePath: string, options: IOptions): Promise<string> {\n  const { folder = '' } = options;\n  const fileName = filePath.replace('.proto', '.js');\n  const pbjsFilePath = path.resolve(process.cwd(), folder, fileName);\n  const p = path.dirname(pbjsFilePath);\n  await mkdirp(p);\n  let cmd:string[] = []\n  if (options.includeProtos && options.includeProtos.length > 0) {\n    cmd = options.includeProtos.reduce((acc, curr) => {\n      return acc.concat(['-p', path.resolve(process.cwd(), curr)]);\n    }, [] as string[]);\n  }\n  cmd.push('-p', options.root, '--keep-case', '-t', 'static-module', '-w', 'commonjs', '-o', pbjsFilePath, path.resolve(process.cwd(), filePath));\n  console.log('pbjs cmd:', cmd.join(' '));\n  return new Promise((resolve, reject) => {\n    pbjs.main(cmd, err => {\n      if (err) {\n        reject(err);\n      }\n      resolve(pbjsFilePath);\n    });\n  });\n}\n","import path from 'path';\nimport pbts from 'protobufjs-cli/pbts';\n\nimport { IOptions } from '../interfaces/IOptions';\n\n/**\n * 通过protobuf-cli生成d.ts文件\n * @param {String} pbjsFilePath 生成的js文件的路径\n * @returns {Promise<string>} 生成临时的js文件的路径\n */\nexport function getPbtsFile(pbjsFilePath: string, options: IOptions): Promise<string> {\n  const { folder = '' } = options;\n  const pbtsFilePath = path.resolve(process.cwd(), folder, pbjsFilePath.replace('.js', '.d.ts'));\n  const cmd = ['-p', options.root, '-o', pbtsFilePath, pbjsFilePath];\n  console.log('pbts cmd:', cmd.join(' '));\n  return new Promise((resolve, reject) => {\n    pbts.main(cmd, err => {\n      if (err) {\n        reject(err);\n      }\n      resolve(pbtsFilePath);\n    });\n  });\n}\n","import fs from 'fs';\nimport path from 'path';\nimport { buildGenerator, getProgramFromFiles } from 'typescript-json-schema';\n\n/**\n * 生成前端api请求JSON Schema 文件\n * @param {String} pbtsFilePath 生成的d.ts定义文件的路径\n * @returns {String} jsonSchemaFilePath 生成的json schema 文件路径\n */\nexport async function saveJSONSchemaFile(pbtsFilePath: string) {\n  const settings = {\n    required: true,\n  };\n  const compilerOptions = {\n    strictNullChecks: true,\n  };\n\n  const program = getProgramFromFiles([path.resolve(pbtsFilePath)], compilerOptions, process.cwd());\n  const generator = buildGenerator(program, settings);\n  const symbols = (generator?.getUserSymbols() || []).filter(symbol => /I(\\S*)Rsp$/.test(symbol));\n  const schema = generator?.getSchemaForSymbols(symbols);\n  const jsonSchemaFilePath = pbtsFilePath.replace('.d.ts', '.json');\n  await fs.promises.writeFile(jsonSchemaFilePath, JSON.stringify(schema, null, 2), { encoding: 'utf-8' });\n  return jsonSchemaFilePath;\n}\n","import fs from 'fs';\nimport { JSONSchemaFaker } from 'json-schema-faker';\nimport { JsonObject, JsonValue } from 'type-fest';\n\n/**\n * 生成前端mockserver返回的 mock 数据的文件\n * @param {String} jsonSchemaFilePath 生成的JSON Schema 文件的路径\n */\nexport async function saveMockJSONFile(jsonSchemaFilePath: string) {\n  const schemaFileStr = await fs.promises.readFile(jsonSchemaFilePath, { encoding: 'utf-8' });\n  const schema = JSON.parse(schemaFileStr);\n\n  JSONSchemaFaker.option({\n    alwaysFakeOptionals: true,\n    resolveJsonPath: true,\n  });\n\n  const json: Record<string, JsonValue> = {};\n  \n  for (const key in schema.definitions) {\n    const rspNameMatchs = key.match(/I(\\S*)Rsp$/);\n    if (!rspNameMatchs) continue;\n\n    const apiName = rspNameMatchs[1];\n    const definitionSchema = schema.definitions[key];\n\n    // 包含 definitions 让 $ref 能找到\n    const fullSchema = {\n      ...definitionSchema,\n      definitions: schema.definitions,\n    };\n\n    const mock = JSONSchemaFaker.generate(fullSchema);\n    json[apiName] = mock;\n  }\n\n  const fileContent = JSON.stringify(json, null, 2);\n  const mockFilePath = jsonSchemaFilePath.replace('.json', '.mock.json');\n  fs.writeFileSync(mockFilePath, fileContent, { encoding: 'utf-8' });\n  return mockFilePath;\n}\n","import express, { Express } from 'express';\nimport fs from 'fs';\n\nimport { IOptions } from '../interfaces/IOptions';\nimport { getRequestMethod } from '../utils/getRequestMethod';\nimport { ApiMethod } from './saveApiFile';\n\n/**\n * 初始化 mock server\n * @param {IOptions} options 用户自定义配置\n * @returns {Express} mockServer 通过express实例化的mock server app\n */\nexport function initServer(options: IOptions) {\n  const mockServer = express();\n  const { port = '3000' } = options;\n  mockServer.listen(+port, () => {\n    console.log(`mock server listening on port ${port}`);\n  });\n  return mockServer;\n}\n\n/**\n * 拿到mock文件和api方法列表，生成mock server 路由\n * @param {ApiMethod[]} apiMethods api方法列表\n * @param {String} mockFilePath mock文件的路径\n * @param {Express} mockServer express server 对象\n * @param {IOptions} options 用户自定义配置\n */\nexport async function generateMockRoute(apiMethods: ApiMethod[], mockFilePath: string, mockServer: Express, options: IOptions) {\n  const { baseUrl } = options;\n  const mockFile = await fs.promises.readFile(mockFilePath, { encoding: 'utf-8' });\n  const json = JSON.parse(mockFile);\n  if (apiMethods) {\n      for (const apiMethod of apiMethods) {\n        if (apiMethod.methodName) {\n          let serviceName = apiMethod.serviceName ? apiMethod.serviceName.slice(0, 1).toUpperCase() + apiMethod.serviceName.slice(1) : '';\n          let requestType = `I${apiMethod.requestType}`;\n          let responseType = `I${apiMethod.responseType}`;\n          if (apiMethod.namespace) {\n            if (apiMethod.namespace.toLowerCase() != serviceName.toLowerCase()) {\n              serviceName = `${apiMethod.namespace}${serviceName}`;\n            }\n            requestType = `${apiMethod.namespace}.${requestType}`;\n            responseType = `${apiMethod.namespace}.${responseType}`;\n          }\n          const httpMethod = apiMethod.httpMethod || 'post';\n          const methodName = apiMethod.methodName || ''\n          const urlPath = apiMethod.urlPath || ''\n          switch (httpMethod.toLowerCase()) {\n            case 'get':\n              mockServer.get(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'post':\n              mockServer.post(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'put':\n              mockServer.put(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'delete':\n              mockServer.delete(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'patch':\n              mockServer.patch(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'head':\n              mockServer.head(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            case 'options':\n              mockServer.options(urlPath, (req, res) => res.send(json[methodName]));\n              break;\n            default:\n              throw new Error(`Unsupported http method: ${httpMethod}`);\n          }\n          console.log(`mockServer generate mock route: ${urlPath} success`);   \n        }\n      }\n    }\n}\n","import chalk from 'chalk';\nimport { Express } from 'express';\nimport glob from 'glob';\nimport minimist from 'minimist';\n\nimport { IOptions } from './interfaces/IOptions';\nimport { initServer } from './modules/mockServer';\nimport { transferTSFile } from './modules/transferTSFile';\n\nconst getUsage = () =>\n  `Usage: ${chalk.bold.green('pb2TSApi')} [options] ${chalk.bold.red('[file1.proto file2.proto ...]')} or ${chalk.bold.red('[./**/*.proto]')}`;\n\nconst getHelp = () =>\n  `Help:\n${chalk.bold.green('--requestModule -r')}: the request module of you want to set, default is ${chalk.bold.red('\\'axios\\'')}, you can set to your custom request method, for example ${chalk.bold.red('\\'@/request\\'')};\n${chalk.bold.green('--baseUrl -b')}: the base url of you want to set, default is ${chalk.bold.red('\\'/\\'')}, you can set to your api path, for example ${chalk.bold.red('\\'/api\\'')};\n${chalk.bold.green('--folder -f')}: the folder of you want to save the output files, default is ${chalk.bold.red('\\'./api\\'')};\n${chalk.bold.green('--root -t')}: the root path set to protobufjs, default is ${chalk.bold.red('the path of this command run')};\n${chalk.bold.green('--optional -o')}: is transfrom d.ts optional to false, because of protobuf 3.0 set all filed is optional, default is ${chalk.bold.red('true')};\n${chalk.bold.green('--mock -m')}: is open mock server, default is ${chalk.bold.red('false')};\n${chalk.bold.green('--port -p')}: mock server port, default is ${chalk.bold.red('3000')}; \n${chalk.bold.green('--include -i')}: include proto files list, default is ${chalk.bold.red('[]')}; \n${chalk.bold.green('--protoOptionTagHttpMethod')}: tag of proto option indicate http method}; \n${chalk.bold.green('--protoOptionTagHttpPath')}: tag of proto option indicate http path};`;\n\nexport async function main() {\n  try {\n    const argv = minimist(process.argv.slice(2), {\n      alias: {\n        requestModule: 'r',\n        baseUrl: 'b',\n        folder: 'f',\n        root: 't',\n        optional: 'o',\n        mock: 'm',\n        port: 'p',\n        help: 'h',\n        includeProtos: 'i',\n      },\n      string: ['requestModule', 'baseUrl', 'folder', 'root', 'port'],\n      boolean: ['optional', 'mock'],\n      default: {\n        requestModule: 'axios',\n        baseUrl: '',\n        folder: './api',\n        root: process.cwd(),\n        optional: true,\n        mock: false,\n        port: '3000',\n        help: '',\n      },\n    });\n    if (argv.help) {\n      process.stderr.write(getHelp());\n      process.exit(1);\n    }\n    const { _: files } = argv;\n    const options: IOptions = {\n      requestModule: argv.requestModule,\n      baseUrl: argv.baseUrl,\n      folder: argv.folder,\n      root: argv.root,\n      optional: argv.optional,\n      mock: argv.mock,\n      port: argv.port,\n      help: argv.help,\n      includeProtos: argv.includeProtos || [], // 新增的包含proto文件路径列表\n      protoOptionTagHttpMethod: argv.protoOptionTagHttpMethod,\n      protoOptionTagHttpPath: argv.protoOptionTagHttpPath,\n    };\n    if (!files.length) {\n      process.stderr.write(getUsage());\n      process.exit(1);\n    }\n    const protoFiles = await glob(files, { ignore: 'node_modules/**', windowsPathsNoEscape: true });\n    if (!protoFiles.length) {\n      process.stderr.write(chalk.bold.red(`there is not files for the flowing paths: \\n ${files.join('\\n')}`));\n      process.exit(1);\n    }\n    let mockServer: Express;\n    if (options.mock) {\n      mockServer = initServer(options);\n    }\n    await Promise.all(protoFiles.map(filePath => transferTSFile(filePath, mockServer, options)));\n  } catch (err) {\n    console.error(err);\n    process.exit(1);\n  }\n}\n\nmain();\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","require","RequestMethods","getProtoOption","descriptor","name","options","startsWith","getLine","serviceName","apiMethods","content","apiMethod","requestType","responseType","namespace","comment","methodName","httpMethod","urlPath","ApiMethod","async","transferTSFile","filePath","mockServer","pbjsFilePath","folder","fileName","replace","path","process","cwd","p","mkdirp","cmd","includeProtos","length","reduce","acc","curr","concat","push","root","console","log","join","Promise","resolve","reject","pbjs","err","getPbjsFile","pbtsFilePath","pbts","getPbtsFile","fs","unlink","protoFilePath","requestModule","baseUrl","tsDefineDirname","tsDefineFilename","apiline","getLinePerfix","protoSource","protobuf","keepCase","preferTrailingComment","alternateCommentMode","resolveAll","traverse","nested","namespacePath","nestedObj","values","method","entries","methods","protoOptionTagHttpMethod","protoOptionTagHttpPath","value","JSON","stringify","protoOptionMethod","protoOptionPath","post","undefined","toLowerCase","childNamespace","parseProtoApiMethods","mapServiceToMethods","Map","_mapServiceToMethods$","slice","toUpperCase","set","writeFile","saveApiFile","jsonSchemaFilePath","program","getProgramFromFiles","strictNullChecks","generator","buildGenerator","required","symbols","getUserSymbols","filter","symbol","test","schema","getSchemaForSymbols","encoding","saveJSONSchemaFile","mockFilePath","schemaFileStr","readFile","parse","JSONSchemaFaker","option","alwaysFakeOptionals","resolveJsonPath","json","definitions","rspNameMatchs","match","apiName","fullSchema","mock","generate","fileContent","saveMockJSONFile","mockFile","req","res","send","put","delete","patch","head","Error","generateMockRoute","argv","minimist","alias","optional","port","help","string","boolean","default","stderr","write","chalk","green","red","exit","_","files","protoFiles","glob","ignore","windowsPathsNoEscape","express","listen","initServer","all","map","error","main"],"ignoreList":[],"sourceRoot":""}